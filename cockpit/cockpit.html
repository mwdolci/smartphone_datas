<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cockpit temps réel</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Cockpit temps réel</h1>

<div class="sensor">
  <h2>Logs WebSocket</h2>
  <pre id="logOutput">En attente de connexion...</pre>
</div>

<div class="sensor">
  <h2>GPS</h2>
  <pre id="gpsOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Accéléromètre</h2>
  <pre id="accelOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Gyroscope</h2>
  <pre id="gyroOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Orientation</h2>
  <pre id="orientationOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Batterie</h2>
  <pre id="batteryOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Microphone</h2>
  <pre id="microOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Caméra</h2>
  <video id="cockpitVideo" width="640" height="480" autoplay></video>
</div>

<div class="sensor">
  <h2>Lumière</h2>
  <pre id="lightOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Heure</h2>
  <pre id="timeOutput">En attente...</pre>
</div>

<div class="sensor">
  <h2>Réseau</h2>
  <pre id="networkOutput">En attente...</pre>
</div>

<script>
const ws = new WebSocket("wss://smartphone-datas.onrender.com");

// Affiche les logs dans la page
function log(msg) {
  const pre = document.getElementById('logOutput');
  pre.textContent += msg + "\n";
  pre.scrollTop = pre.scrollHeight;
}

// Gestion WebSocket
ws.onopen = () => log("WebSocket ouverte !");
ws.onmessage = event => {
  const msg = JSON.parse(event.data);
  log("Reçu : " + JSON.stringify(msg));
  const data = msg.data;

  switch(msg.capteur) {
    case "gps": document.getElementById('gpsOutput').textContent = JSON.stringify(data, null, 2); break;
    case "accelerometre": document.getElementById('accelOutput').textContent = JSON.stringify(data, null, 2); break;
    case "gyroscope": document.getElementById('gyroOutput').textContent = JSON.stringify(data, null, 2); break;
    case "orientation": document.getElementById('orientationOutput').textContent = JSON.stringify(data, null, 2); break;
    case "battery": document.getElementById('batteryOutput').textContent = JSON.stringify(data, null, 2); break;
    case "micro": document.getElementById('microOutput').textContent = JSON.stringify(data, null, 2); break;
    case "camera": document.getElementById('cameraVideo').title = "Streaming"; break;
    case "light": document.getElementById('lightOutput').textContent = JSON.stringify(data, null, 2); break;
    case "time": document.getElementById('timeOutput').textContent = JSON.stringify(data, null, 2); break;
    case "network": document.getElementById('networkOutput').textContent = JSON.stringify(data, null, 2); break;
    default: break;
  }
};

ws.onerror = e => log("Erreur WebSocket : " + e);
ws.onclose = e => log("WebSocket fermée.");

// Fonction pour envoyer les données depuis le smartphone
function sendSensor(name, data) {
  if (ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ capteur: name, data }));
    log("Envoyé : " + name);
  } else {
    log("WebSocket pas ouverte pour " + name + ", réessai...");
    setTimeout(() => sendSensor(name, data), 500);
  }
}
</script>

</body>
</html>
